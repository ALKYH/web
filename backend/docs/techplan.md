### **å¯èˆªå¼•è·¯äºº - ç•™å­¦åŒè¾¹ä¿¡æ¯å¹³å°åç«¯æŠ€æœ¯æ–‡æ¡£**

**ç‰ˆæœ¬:** 2.0
**é¡¹ç›®åç§°:** å¯èˆªå¼•è·¯äºº (PeerPortal) - AIç•™å­¦è§„åˆ’å¸ˆå¹³å°
**ç›®æ ‡:** æœ¬æ–‡æ¡£æ—¨åœ¨ä¸º"å¯èˆªå¼•è·¯äºº"ç•™å­¦åŒè¾¹ä¿¡æ¯å¹³å°çš„åç«¯å¼€å‘æä¾›å…¨é¢çš„æŠ€æœ¯è§„èŒƒã€‚è¯¥å¹³å°åŸºäº`libs/app`åˆ†ç¦»æ¶æ„ï¼Œé‡‡ç”¨FastAPI + Supabase + LangGraphæ„å»ºï¼Œé›†æˆAIæ™ºèƒ½å¯¹è¯ã€å®æ—¶æ¶ˆæ¯ã€ç²¾å‡†åŒ¹é…ç­‰å…¨æ–¹ä½ç•™å­¦ç”³è¯·æŒ‡å¯¼åŠŸèƒ½ã€‚

### 1. ä¸šåŠ¡åœºæ™¯ä¸å¹³å°å®šä½

#### 1.1 æ ¸å¿ƒä¸šåŠ¡æ¨¡å¼

**ç•™å­¦åŒè¾¹ä¿¡æ¯å¹³å°**æ˜¯ä¸€ä¸ªè¿æ¥ç•™å­¦ç”³è¯·è€…ï¼ˆå­¦å¼Ÿå­¦å¦¹ï¼‰ä¸ç›®æ ‡å­¦æ ¡å­¦é•¿å­¦å§çš„ä¸“ä¸šæœåŠ¡å¹³å°ï¼š

- **ç”³è¯·è€…ç«¯ï¼ˆå­¦å¼Ÿå­¦å¦¹ï¼‰**ï¼šå¯»æ‰¾ç›®æ ‡å­¦æ ¡é™¢ç³»çš„å­¦é•¿å­¦å§ï¼Œè·å¾—ç•™å­¦ç”³è¯·æŒ‡å¯¼
- **æŒ‡å¯¼è€…ç«¯ï¼ˆå­¦é•¿å­¦å§ï¼‰**ï¼šæä¾›ä¸“ä¸šçš„ç•™å­¦ç”³è¯·æŒ‡å¯¼æœåŠ¡ï¼ŒåŒ…æ‹¬æ–‡ä¹¦ä¿®æ”¹ã€æ¨èä¿¡å»ºè®®ã€é¢è¯•è¾…å¯¼ç­‰
- **å¹³å°ä»·å€¼**ï¼šé€šè¿‡ç²¾å‡†åŒ¹é…ï¼Œè®©ç”³è¯·è€…è·å¾—ç¬¬ä¸€æ‰‹çš„ç”³è¯·ç»éªŒå’Œä¸ªæ€§åŒ–æŒ‡å¯¼

#### 1.2 æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

| åŠŸèƒ½æ¨¡å—     | å­¦å¼Ÿå­¦å¦¹ç«¯                     | å­¦é•¿å­¦å§ç«¯               | å¹³å°ç®¡ç†           |
| ------------ | ------------------------------ | ------------------------ | ------------------ |
| **ç”¨æˆ·ç®¡ç†** | ç”³è¯·è€…èµ„æ–™ã€ç”³è¯·ç›®æ ‡è®¾ç½®       | æŒ‡å¯¼è€…èµ„æ–™ã€å­¦æ ¡é™¢ç³»è®¤è¯ | ç”¨æˆ·å®¡æ ¸ã€èº«ä»½éªŒè¯ |
| **åŒ¹é…ç³»ç»Ÿ** | æŒ‰å­¦æ ¡/ä¸“ä¸š/ç”³è¯·æ–¹å‘ç­›é€‰æŒ‡å¯¼è€… | è®¾ç½®æŒ‡å¯¼é¢†åŸŸå’Œæ—¶é—´å®‰æ’   | æ™ºèƒ½æ¨èç®—æ³•       |
| **æœåŠ¡äº¤æ˜“** | æµè§ˆå’Œè´­ä¹°æŒ‡å¯¼æœåŠ¡             | å‘å¸ƒæŒ‡å¯¼æœåŠ¡ã€è®¾ç½®ä»·æ ¼   | äº¤æ˜“ä¿éšœã€çº çº·å¤„ç† |
| **æ²Ÿé€šåä½œ** | å®æ—¶æ¶ˆæ¯ã€æ–‡æ¡£å…±äº«             | æŒ‡å¯¼åé¦ˆã€è¿›åº¦è·Ÿè¸ª       | å¯¹è¯ç›‘æ§ã€è´¨é‡ä¿è¯ |
| **è¯„ä»·ä½“ç³»** | å¯¹æŒ‡å¯¼è€…è¯„ä»·                   | è·å¾—ä¿¡èª‰ç§¯ç´¯             | ä¿¡èª‰ç®—æ³•ã€æ’åç³»ç»Ÿ |

### 2. æŠ€æœ¯æ ˆä¸æ¶æ„è®¾è®¡

#### 2.1 æ ¸å¿ƒæŠ€æœ¯æ ˆ

| ç±»åˆ«           | æŠ€æœ¯æ ˆ                          | ç‰ˆæœ¬    | æ ¸å¿ƒä½œç”¨                                                                 |
| :------------- | :------------------------------ | :------ | :----------------------------------------------------------------------- |
| **æ ¸å¿ƒæ¡†æ¶**   | **FastAPI**                     | 0.116.1 | é«˜æ€§èƒ½å¼‚æ­¥APIæ¡†æ¶ï¼Œæ”¯æŒè‡ªåŠ¨APIæ–‡æ¡£ç”Ÿæˆå’Œä¾èµ–æ³¨å…¥                       |
| **æ•°æ®éªŒè¯**   | **Pydantic V2**                 | 2.x     | è¿è¡Œæ—¶æ•°æ®éªŒè¯ï¼Œä¿éšœAPIæ•°æ®å®Œæ•´æ€§                                       |
| **æ•°æ®åº“**     | **Supabase (PostgreSQL)**       | latest  | äº‘åŸç”ŸPostgreSQLæ•°æ®åº“ï¼Œæ”¯æŒå®æ—¶è®¢é˜…å’Œå­˜å‚¨                             |
| **æ•°æ®åº“äº¤äº’** | **`asyncpg`**                   | latest  | é«˜æ€§èƒ½å¼‚æ­¥PostgreSQLé©±åŠ¨ï¼Œæ”¯æŒè¿æ¥æ±                                      |
| **è®¤è¯é‰´æƒ**   | **JWT + `python-jose`**         | latest  | æ— çŠ¶æ€JWTè®¤è¯ï¼Œæ”¯æŒå¤šé‡èº«ä»½éªŒè¯                                         |
| **AIæ™ºèƒ½ä½“**   | **LangGraph**                   | 0.2.51  | AIå·¥ä½œæµç¼–æ’ï¼Œæ”¯æŒå¤æ‚å¯¹è¯é€»è¾‘                                          |
| **å¤§è¯­è¨€æ¨¡å‹** | **OpenAI GPT**                  | 4o-mini | æ™ºèƒ½å¯¹è¯å’Œç•™å­¦è§„åˆ’æ¨ç†                                                 |
| **å‘é‡æ•°æ®åº“** | **ChromaDB**                    | 0.5.15  | çŸ¥è¯†åº“å‘é‡åŒ–å­˜å‚¨ï¼Œæ”¯æŒè¯­ä¹‰æ£€ç´¢                                         |
| **ç½‘ç»œæœç´¢**   | **Tavily**                      | latest  | å®æ—¶ç½‘ç»œä¿¡æ¯æ£€ç´¢ï¼Œè·å–æœ€æ–°ç•™å­¦èµ„è®¯                                     |
| **ä¾èµ–ç®¡ç†**   | **Poetry**                      | latest  | Pythoné¡¹ç›®ä¾èµ–ç®¡ç†å’Œæ‰“åŒ…å·¥å…·                                           |

#### 2.2 æ¶æ„è®¾è®¡ç†å¿µ

æœ¬é¡¹ç›®é‡‡ç”¨**`libs/app`åˆ†ç¦»æ¶æ„**ï¼Œå®ç°å…³æ³¨ç‚¹åˆ†ç¦»ï¼š

- **`libs/`**: åŸºç¡€è®¾æ–½å±‚ï¼ŒåŒ…å«å¯å¤ç”¨çš„æ ¸å¿ƒç»„ä»¶
- **`apps/`**: ä¸šåŠ¡é€»è¾‘å±‚ï¼Œä¸“æ³¨å…·ä½“ä¸šåŠ¡åŠŸèƒ½å®ç°
- **ä¸‰å±‚æ¶æ„**: `Endpoints` â†’ `Services` â†’ `Repositories`

### 3. æ•°æ®åº“è®¾è®¡ç†å¿µ

#### 3.1 å®é™…æ•°æ®åº“æ¶æ„

åŸºäºSupabase PostgreSQLçš„29è¡¨å®Œæ•´æ•°æ®æ¨¡å‹ï¼š

```
ğŸ“Š å¯èˆªå¼•è·¯äººæ•°æ®æ¶æ„ (29è¡¨)
â”œâ”€â”€ ğŸ‘¥ ç”¨æˆ·ä¸ç¤¾äº¤ç³»ç»Ÿ (6è¡¨)
â”‚   â”œâ”€â”€ users                    # ç”¨æˆ·åŸºç¡€ä¿¡æ¯
â”‚   â”œâ”€â”€ profiles                 # è¯¦ç»†ä¸ªäººèµ„æ–™
â”‚   â”œâ”€â”€ friends                  # ç”¨æˆ·å¥½å‹å…³ç³»
â”‚   â”œâ”€â”€ user_credit_logs         # ç”¨æˆ·ç§¯åˆ†è®°å½•
â”‚   â”œâ”€â”€ user_wallets             # ç”¨æˆ·é’±åŒ…ç³»ç»Ÿ
â”‚   â””â”€â”€ user_reputation_stats    # ç”¨æˆ·ä¿¡èª‰ç»Ÿè®¡
â”‚
â”œâ”€â”€ ğŸ’¬ æ²Ÿé€šç³»ç»Ÿ (5è¡¨)
â”‚   â”œâ”€â”€ conversations            # å¯¹è¯ä¼šè¯
â”‚   â”œâ”€â”€ conversation_participants # ä¼šè¯å‚ä¸è€…
â”‚   â”œâ”€â”€ messages                 # æ¶ˆæ¯å†…å®¹
â”‚   â”œâ”€â”€ uploaded_files           # æ–‡ä»¶ä¸Šä¼ ç®¡ç†
â”‚   â””â”€â”€ forum_posts              # è®ºå›å¸–å­ (æ‰©å±•åŠŸèƒ½)
â”‚   â”œâ”€â”€ forum_replies            # è®ºå›å›å¤
â”‚   â”œâ”€â”€ forum_likes              # è®ºå›ç‚¹èµ
â”‚   â””â”€â”€ forum_reply_likes        # å›å¤ç‚¹èµ
â”‚
â”œâ”€â”€ ğŸ“ ç•™å­¦æŒ‡å¯¼ç³»ç»Ÿ (8è¡¨)
â”‚   â”œâ”€â”€ mentor_matches           # å¯¼å¸ˆåŒ¹é…è®°å½•
â”‚   â”œâ”€â”€ mentorship_relationships # æŒ‡å¯¼å…³ç³»ç®¡ç†
â”‚   â”œâ”€â”€ mentorship_sessions      # æŒ‡å¯¼ä¼šè¯è®°å½•
â”‚   â”œâ”€â”€ mentorship_reviews       # æŒ‡å¯¼è¯„ä»·
â”‚   â”œâ”€â”€ mentorship_transactions  # æŒ‡å¯¼äº¤æ˜“
â”‚   â”œâ”€â”€ services                 # æŒ‡å¯¼æœåŠ¡å‘å¸ƒ
â”‚   â”œâ”€â”€ orders                   # æœåŠ¡è®¢å•
â”‚   â””â”€â”€ reviews                  # æœåŠ¡è¯„ä»·
â”‚
â”œâ”€â”€ ğŸ› ï¸ æŠ€èƒ½ä¸åŒ¹é…ç³»ç»Ÿ (4è¡¨)
â”‚   â”œâ”€â”€ skill_categories         # æŠ€èƒ½åˆ†ç±» (å•†ç§‘ã€å·¥ç§‘ç­‰)
â”‚   â”œâ”€â”€ skills                   # å…·ä½“æŠ€èƒ½é¡¹
â”‚   â”œâ”€â”€ user_skills              # ç”¨æˆ·æŠ€èƒ½æ˜ å°„
â”‚   â””â”€â”€ user_learning_needs      # å­¦ä¹ éœ€æ±‚åˆ†æ
â”‚
â””â”€â”€ ğŸ“… æ—¶é—´ç®¡ç† (2è¡¨)
    â”œâ”€â”€ user_availability        # ç”¨æˆ·å¯ç”¨æ—¶é—´
    â””â”€â”€ user_unavailable_periods # ä¸å¯ç”¨æ—¶é—´æ®µ
```

#### 3.2 æ ¸å¿ƒä¸šåŠ¡è¡¨è¯¦è§£

**ğŸ“ ç•™å­¦æŒ‡å¯¼ç³»ç»Ÿæ ¸å¿ƒè¡¨**ï¼š

- `mentorship_relationships`ï¼šç®¡ç†å­¦é•¿å­¦å§ä¸å­¦å¼Ÿå­¦å¦¹çš„æŒ‡å¯¼å…³ç³»ï¼ŒåŒ…å«ç›®æ ‡å­¦æ ¡ã€ä¸“ä¸šã€ç”³è¯·é˜¶æ®µç­‰30ä¸ªå­—æ®µ
- `mentorship_transactions`ï¼šè®°å½•æŒ‡å¯¼æœåŠ¡çš„ä»˜è´¹äº¤æ˜“ï¼Œæ”¯æŒæ–‡ä¹¦æŒ‡å¯¼ã€æ¨èä¿¡å»ºè®®ç­‰ä¸åŒæœåŠ¡ç±»å‹
- `mentorship_sessions`ï¼šè¿½è¸ªæ¯æ¬¡æŒ‡å¯¼ä¼šè¯ï¼ŒåŒ…æ‹¬æŒ‡å¯¼å†…å®¹ã€æ—¶é•¿ã€æ•ˆæœåé¦ˆç­‰

**ğŸ› ï¸ ä¸“ä¸šæŠ€èƒ½ç³»ç»Ÿ**ï¼š

- `skill_categories`ï¼šç•™å­¦ç”³è¯·æ–¹å‘åˆ†ç±»ï¼ˆå•†ç§‘ã€å·¥ç§‘ã€åŒ»å­¦ã€è‰ºæœ¯ç­‰6å¤§ç±»ï¼‰
- `skills`ï¼šå…·ä½“ä¸“ä¸šæ–¹å‘ï¼ˆé‡‘èã€è®¡ç®—æœºç§‘å­¦ã€æœºæ¢°å·¥ç¨‹ç­‰31ä¸ªä¸“ä¸šï¼‰
- `user_skills`ï¼šå­¦é•¿å­¦å§çš„ä¸“ä¸šèƒŒæ™¯å’ŒæŒ‡å¯¼èƒ½åŠ›æ˜ å°„

**ğŸ’ ç”¨æˆ·æ‰©å±•ç³»ç»Ÿ**ï¼š

- `user_learning_needs`ï¼šç”³è¯·è€…çš„å…·ä½“éœ€æ±‚ï¼ˆç›®æ ‡å­¦æ ¡ã€ä¸“ä¸šã€ç”³è¯·æ—¶é—´çº¿ç­‰ï¼‰
- `user_reputation_stats`ï¼šæŒ‡å¯¼è€…çš„ä¿¡èª‰è¯„åˆ†ã€æˆåŠŸæ¡ˆä¾‹æ•°é‡ç­‰ç»Ÿè®¡
- `user_availability`ï¼šæŒ‡å¯¼è€…çš„å¯ç”¨æ—¶é—´æ®µç®¡ç†

### 4. é¡¹ç›®ç»“æ„

åŸºäº`libs/app`åˆ†ç¦»æ¶æ„çš„æ¨¡å—åŒ–è®¾è®¡ï¼Œå®ç°åŸºç¡€è®¾æ–½ä¸ä¸šåŠ¡é€»è¾‘çš„æ¸…æ™°åˆ†ç¦»ã€‚

```
backend/
â”œâ”€â”€ apps/                         # ğŸ“¦ ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ api/                      # ğŸŒ APIå±‚
â”‚   â”‚   â””â”€â”€ v1/                   # APIç‰ˆæœ¬ç®¡ç†
â”‚   â”‚       â”œâ”€â”€ endpoints/        # ğŸ¯ è·¯ç”±ç«¯ç‚¹ (Endpointså±‚)
â”‚   â”‚       â”‚   â”œâ”€â”€ agents.py     # ğŸ¤– AIæ™ºèƒ½ä½“API
â”‚   â”‚       â”‚   â”œâ”€â”€ auth.py       # ğŸ” ç”¨æˆ·è®¤è¯API
â”‚   â”‚       â”‚   â”œâ”€â”€ files.py      # ğŸ“ æ–‡ä»¶ç®¡ç†API
â”‚   â”‚       â”‚   â”œâ”€â”€ matchings.py  # ğŸ¯ æ™ºèƒ½åŒ¹é…API
â”‚   â”‚       â”‚   â”œâ”€â”€ mentors.py    # ğŸ‘¨â€ğŸ« å¯¼å¸ˆç®¡ç†API
â”‚   â”‚       â”‚   â”œâ”€â”€ messages.py   # ğŸ’¬ æ¶ˆæ¯ç³»ç»ŸAPI
â”‚   â”‚       â”‚   â”œâ”€â”€ services.py   # ğŸ›ï¸ æœåŠ¡ç®¡ç†API
â”‚   â”‚       â”‚   â”œâ”€â”€ sessions.py   # ğŸ“… ä¼šè¯ç®¡ç†API
â”‚   â”‚       â”‚   â”œâ”€â”€ students.py   # ğŸ‘¨â€ğŸ“ å­¦ç”Ÿæ¡£æ¡ˆAPI
â”‚   â”‚       â”‚   â””â”€â”€ users.py      # ğŸ‘¥ ç”¨æˆ·ç®¡ç†API
â”‚   â”‚       â”œâ”€â”€ services/         # ğŸ—ï¸ ä¸šåŠ¡é€»è¾‘å±‚ (Serviceså±‚)
â”‚   â”‚       â”‚   â”œâ”€â”€ *.py          # å„æ¨¡å—ä¸šåŠ¡é€»è¾‘
â”‚   â”‚       â”œâ”€â”€ repositories/     # ğŸ’¾ æ•°æ®è®¿é—®å±‚ (Repositorieså±‚)
â”‚   â”‚       â”‚   â”œâ”€â”€ *.py          # å„æ¨¡å—æ•°æ®è®¿é—®
â”‚   â”‚       â””â”€â”€ deps.py           # ğŸ”— ä¾èµ–æ³¨å…¥é…ç½®
â”‚   â”œâ”€â”€ schemas/                  # ğŸ“‹ æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ *.py                  # Pydanticæ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ main.py                   # ğŸš€ FastAPIåº”ç”¨å…¥å£
â”‚
â”œâ”€â”€ libs/                         # ğŸ—ï¸ åŸºç¡€è®¾æ–½å±‚
â”‚   â”œâ”€â”€ agents/                   # ğŸ¤– AIæ™ºèƒ½ä½“ç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ v2/                   # ç¬¬äºŒä»£æ™ºèƒ½ä½“å®ç°
â”‚   â”‚       â”œâ”€â”€ ai_foundation/    # ğŸ¤– AIåŸºç¡€è®¾æ–½
â”‚   â”‚       â”‚   â”œâ”€â”€ agents/       # æ™ºèƒ½ä½“å·¥å‚
â”‚   â”‚       â”‚   â”œâ”€â”€ llm/          # å¤§è¯­è¨€æ¨¡å‹ç®¡ç†
â”‚   â”‚       â”‚   â””â”€â”€ memory/       # è®°å¿†ç³»ç»Ÿ
â”‚   â”‚       â”œâ”€â”€ core_infrastructure/ # ğŸ—ï¸ æ ¸å¿ƒåŸºç¡€è®¾æ–½
â”‚   â”‚       â”‚   â”œâ”€â”€ error/        # å¼‚å¸¸å¤„ç†
â”‚   â”‚       â”‚   â”œâ”€â”€ oss/          # å¯¹è±¡å­˜å‚¨
â”‚   â”‚       â”‚   â””â”€â”€ utils/        # å·¥å…·å‡½æ•°
â”‚   â”‚       â”œâ”€â”€ data_communication/ # ğŸ“¡ æ•°æ®é€šä¿¡
â”‚   â”‚       â”‚   â””â”€â”€ rag/          # RAGçŸ¥è¯†æ£€ç´¢
â”‚   â”‚       â”œâ”€â”€ tools/            # ğŸ› ï¸ æ™ºèƒ½ä½“å·¥å…·
â”‚   â”‚       â””â”€â”€ config.py         # âš™ï¸ æ™ºèƒ½ä½“é…ç½®
â”‚   â”œâ”€â”€ config/                   # âš™ï¸ é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ settings.py           # ä¸»é…ç½®å…¥å£
â”‚   â”‚   â”œâ”€â”€ database_config.py    # æ•°æ®åº“é…ç½®
â”‚   â”‚   â”œâ”€â”€ ai_config.py          # AIæ¨¡å‹é…ç½®
â”‚   â”‚   â”œâ”€â”€ security_config.py    # å®‰å…¨é…ç½®
â”‚   â”‚   â””â”€â”€ *.py                  # å…¶ä»–ä¸“é¡¹é…ç½®
â”‚   â”œâ”€â”€ database/                 # ğŸ’¾ æ•°æ®åº“è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ connection.py         # è¿æ¥ç®¡ç†
â”‚   â”‚   â””â”€â”€ adapters.py           # æ•°æ®åº“é€‚é…å™¨
â”‚   â”œâ”€â”€ exceptions/               # ğŸš¨ å¼‚å¸¸å¤„ç†
â”‚   â”œâ”€â”€ logging/                  # ğŸ“ æ—¥å¿—ç³»ç»Ÿ
â”‚   â”œâ”€â”€ security/                 # ğŸ”’ å®‰å…¨å·¥å…·
â”‚   â””â”€â”€ utils/                    # ğŸ› ï¸ é€šç”¨å·¥å…·
â”‚
â”œâ”€â”€ scripts/                      # ğŸ› ï¸ å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ database/                 # ğŸ’¾ æ•°æ®åº“ç®¡ç†è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ export_schema.py      # å¯¼å‡ºæ•°æ®åº“ç»“æ„
â”‚   â”‚   â”œâ”€â”€ snapshot_to_sql.py    # ç”ŸæˆSQLè„šæœ¬
â”‚   â”‚   â”œâ”€â”€ migrate_remote.py     # è¿œç¨‹è¿ç§»æ‰§è¡Œ
â”‚   â”‚   â””â”€â”€ check_alignment.py    # å¯¹é½æ£€æŸ¥
â”‚   â””â”€â”€ *.sh                      # éƒ¨ç½²å’Œå¯åŠ¨è„šæœ¬
â”‚
â”œâ”€â”€ docs/                        # ğŸ“š é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ tests/                       # ğŸ§ª æµ‹è¯•å¥—ä»¶
â”œâ”€â”€ supabase/                    # â˜ï¸ Supabaseé…ç½®
â”‚   â”œâ”€â”€ schema_snapshot.json     # æ•°æ®åº“ç»“æ„å¿«ç…§
â”‚   â””â”€â”€ schema.sql               # æ•°æ®åº“è¿ç§»è„šæœ¬
â”œâ”€â”€ uploads/                     # ğŸ“ æ–‡ä»¶ä¸Šä¼ å­˜å‚¨
â”‚   â”œâ”€â”€ avatars/                 # ç”¨æˆ·å¤´åƒ
â”‚   â””â”€â”€ documents/               # æ–‡æ¡£å­˜å‚¨
â”œâ”€â”€ vector_store/                # ğŸ§  å‘é‡æ•°æ®åº“
â”œâ”€â”€ pyproject.toml               # ğŸ“¦ é¡¹ç›®é…ç½®
â”œâ”€â”€ poetry.lock                  # ğŸ”’ ä¾èµ–é”å®š
â””â”€â”€ README.md                    # ğŸ“– é¡¹ç›®è¯´æ˜
```

### 5. æ ¸å¿ƒAPIè®¾è®¡

#### 5.1 AIæ™ºèƒ½ä½“API (`/api/v2/agents`)

```python
# AIç•™å­¦è§„åˆ’å¸ˆæ¥å£
POST   /api/v2/agents/chat/planner       # ä¸ç•™å­¦è§„åˆ’å¸ˆå¯¹è¯
POST   /api/v2/agents/chat/consultant    # ä¸ç•™å­¦é¡¾é—®å¯¹è¯
POST   /api/v2/agents/chat/auto          # æ™ºèƒ½è‡ªåŠ¨å¯¹è¯
GET    /api/v2/agents/status             # AIç³»ç»ŸçŠ¶æ€æ£€æŸ¥
```

#### 5.2 ç”¨æˆ·è®¤è¯API (`/api/v1/auth`)

```python
POST   /api/v1/auth/login               # ç”¨æˆ·ç™»å½•
POST   /api/v1/auth/register            # ç”¨æˆ·æ³¨å†Œ
POST   /api/v1/auth/refresh             # åˆ·æ–°ä»¤ç‰Œ
POST   /api/v1/auth/logout              # ç”¨æˆ·ç™»å‡º
```

#### 5.3 ç”¨æˆ·ç®¡ç†API (`/api/v1/users`)

```python
GET    /api/v1/users/me                 # è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
PUT    /api/v1/users/me                 # æ›´æ–°ç”¨æˆ·ä¿¡æ¯
GET    /api/v1/users/{id}               # è·å–æŒ‡å®šç”¨æˆ·ä¿¡æ¯
GET    /api/v1/users/                   # ç”¨æˆ·åˆ—è¡¨ï¼ˆç®¡ç†å‘˜ï¼‰
```

#### 5.4 å¯¼å¸ˆç®¡ç†API (`/api/v1/mentors`)

```python
GET    /api/v1/mentors                  # æµè§ˆå¯¼å¸ˆåˆ—è¡¨
GET    /api/v1/mentors/{id}             # æŸ¥çœ‹å¯¼å¸ˆè¯¦æƒ…
POST   /api/v1/mentors/profile          # æ³¨å†Œæˆä¸ºå¯¼å¸ˆ
PUT    /api/v1/mentors/profile          # æ›´æ–°å¯¼å¸ˆèµ„æ–™
GET    /api/v1/mentors/services         # æŸ¥çœ‹å¯¼å¸ˆæœåŠ¡
```

#### 5.5 å­¦ç”Ÿæ¡£æ¡ˆAPI (`/api/v1/students`)

```python
POST   /api/v1/students/profile          # å®Œå–„å­¦ç”Ÿèµ„æ–™
PUT    /api/v1/students/learning-needs   # è®¾ç½®å­¦ä¹ éœ€æ±‚
GET    /api/v1/students/matches          # è·å–æ¨èå¯¼å¸ˆ
GET    /api/v1/students/orders           # æŸ¥çœ‹æœåŠ¡è®¢å•
```

#### 5.6 æ™ºèƒ½åŒ¹é…API (`/api/v1/matching`)

```python
POST   /api/v1/matching/recommend        # åŸºäºéœ€æ±‚æ¨èå¯¼å¸ˆ
GET    /api/v1/matching/filters          # è·å–ç­›é€‰æ¡ä»¶
POST   /api/v1/matching/create           # åˆ›å»ºåŒ¹é…å…³ç³»
GET    /api/v1/matching/history          # æŸ¥çœ‹åŒ¹é…å†å²
```

#### 5.7 æ¶ˆæ¯ç³»ç»ŸAPI (`/api/v1/messages`)

```python
GET    /api/v1/messages/conversations    # è·å–å¯¹è¯åˆ—è¡¨
GET    /api/v1/messages/{conversation_id} # è·å–å¯¹è¯æ¶ˆæ¯
POST   /api/v1/messages/send             # å‘é€æ¶ˆæ¯
PUT    /api/v1/messages/{id}/read        # æ ‡è®°å·²è¯»
```

#### 5.8 æ–‡ä»¶ç®¡ç†API (`/api/v1/files`)

```python
POST   /api/v1/files/upload/avatar       # ä¸Šä¼ å¤´åƒ
POST   /api/v1/files/upload/document     # ä¸Šä¼ æ–‡æ¡£
GET    /api/v1/files/{id}                # è·å–æ–‡ä»¶ä¿¡æ¯
DELETE /api/v1/files/{id}                # åˆ é™¤æ–‡ä»¶
```

### 6. æ•°æ®åº“è¿æ¥ä¸é€‚é…å™¨

#### 6.1 è¿æ¥ç®¡ç† (`libs/database/connection.py`)

åŸºäº`asyncpg`çš„è¿æ¥æ± ç®¡ç†ï¼Œæ”¯æŒè‡ªåŠ¨é‡è¿å’Œè¿æ¥ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼š

```python
from contextlib import asynccontextmanager
from fastapi import FastAPI, Depends
from typing import AsyncGenerator
import asyncpg
import logging

@asynccontextmanager
async def lifespan(app: FastAPI):
    """åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†"""
    global db_pool
    # åˆ›å»ºè¿æ¥æ± 
    db_pool = await asyncpg.create_pool(
        dsn=settings.postgres_url,
        min_size=1, max_size=10,
        command_timeout=30
    )
    yield
    # å…³é—­è¿æ¥æ± 
    await db_pool.close()

async def get_database_adapter() -> AsyncGenerator[DatabaseAdapter, None]:
    """æŒ‰è¯·æ±‚æä¾›æ•°æ®åº“é€‚é…å™¨"""
    async with db_pool.acquire() as connection:
        adapter = PostgreSQLAdapter(connection)
        yield adapter
```

#### 6.2 æ•°æ®åº“é€‚é…å™¨ (`libs/database/adapters.py`)

ç»Ÿä¸€çš„æ•°æ®åº“æ“ä½œæ¥å£ï¼Œæ”¯æŒPostgreSQLå’ŒSupabaseï¼š

```python
class DatabaseAdapter(ABC):
    @abstractmethod
    async def fetch_one(self, query: str, *args) -> Optional[Dict]:
        """è·å–å•æ¡è®°å½•"""
        pass

    @abstractmethod
    async def fetch_all(self, query: str, *args) -> List[Dict]:
        """è·å–å¤šæ¡è®°å½•"""
        pass

    @abstractmethod
    async def execute(self, query: str, *args) -> str:
        """æ‰§è¡ŒSQLå‘½ä»¤"""
        pass

class PostgreSQLAdapter(DatabaseAdapter):
    """PostgreSQLé€‚é…å™¨å®ç°"""
    def __init__(self, connection):
        self.connection = connection

    async def fetch_one(self, query: str, *args) -> Optional[Dict]:
        result = await self.connection.fetchrow(query, *args)
        return dict(result) if result else None
```

### 7. AIæ™ºèƒ½ä½“ç³»ç»Ÿæ¶æ„

#### 7.1 ç³»ç»Ÿæ¶æ„ (`libs/agents/v2/`)

ç¬¬äºŒä»£AIæ™ºèƒ½ä½“é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼š

```
libs/agents/v2/
â”œâ”€â”€ ai_foundation/           # ğŸ¤– AIåŸºç¡€è®¾æ–½
â”‚   â”œâ”€â”€ agents/              # æ™ºèƒ½ä½“å·¥å‚
â”‚   â”œâ”€â”€ llm/                 # å¤§è¯­è¨€æ¨¡å‹ç®¡ç†
â”‚   â””â”€â”€ memory/              # è®°å¿†ç³»ç»Ÿ
â”œâ”€â”€ core_infrastructure/     # ğŸ—ï¸ æ ¸å¿ƒåŸºç¡€è®¾æ–½
â”‚   â”œâ”€â”€ error/               # å¼‚å¸¸å¤„ç†
â”‚   â”œâ”€â”€ oss/                 # å¯¹è±¡å­˜å‚¨
â”‚   â””â”€â”€ utils/               # å·¥å…·å‡½æ•°
â”œâ”€â”€ data_communication/      # ğŸ“¡ æ•°æ®é€šä¿¡
â”‚   â””â”€â”€ rag/                 # RAGçŸ¥è¯†æ£€ç´¢
â”œâ”€â”€ tools/                   # ğŸ› ï¸ æ™ºèƒ½ä½“å·¥å…·
â””â”€â”€ config.py                # âš™ï¸ æ™ºèƒ½ä½“é…ç½®
```

#### 7.2 æ ¸å¿ƒç»„ä»¶

- **æ™ºèƒ½ä½“å·¥å‚**: åˆ›å»ºå’Œç®¡ç†ä¸åŒç±»å‹çš„AIæ™ºèƒ½ä½“
- **LLMç®¡ç†å™¨**: ç»Ÿä¸€ç®¡ç†OpenAIç­‰å¤§è¯­è¨€æ¨¡å‹æ¥å£
- **è®°å¿†ç³»ç»Ÿ**: æ”¯æŒä¼šè¯è®°å¿†å’Œé•¿æœŸè®°å¿†ç®¡ç†
- **RAGç³»ç»Ÿ**: åŸºäºå‘é‡æ£€ç´¢çš„çŸ¥è¯†åº“é—®ç­”
- **å·¥å…·é›†æˆ**: ç½‘ç»œæœç´¢ã€æ•°æ®åº“æŸ¥è¯¢ç­‰å¤–éƒ¨å·¥å…·

### 8. é…ç½®ç®¡ç†ç³»ç»Ÿ

#### 8.1 é…ç½®æ¶æ„ (`libs/config/`)

æ¨¡å—åŒ–çš„é…ç½®ç®¡ç†ï¼š

```python
# libs/config/settings.py
from libs.config.database_config import DatabaseConfig
from libs.config.ai_config import AIConfig
from libs.config.security_config import SecurityConfig

class Settings(BaseSettings):
    """ä¸»é…ç½®ç±»ï¼Œç»„åˆå„ä¸ªä¸“é¡¹é…ç½®"""

    # åº”ç”¨åŸºæœ¬é…ç½®
    APP_NAME: str = "å¯èˆªå¼•è·¯äºº API"
    VERSION: str = "2.0.0"
    DEBUG: bool = False

    def __init__(self, **kwargs):
        super().__init__(**kwargs)
        # åˆå§‹åŒ–ä¸“é¡¹é…ç½®
        self.database = DatabaseConfig()
        self.ai = AIConfig()
        self.security = SecurityConfig()
```

#### 8.2 ä¸“é¡¹é…ç½®

- **æ•°æ®åº“é…ç½®**: PostgreSQL/Supabaseè¿æ¥å‚æ•°
- **AIé…ç½®**: OpenAIã€Tavilyç­‰APIå¯†é’¥
- **å®‰å…¨é…ç½®**: JWTå¯†é’¥ã€åŠ å¯†å‚æ•°

### 9. éƒ¨ç½²ä¸è¿ç»´

#### 9.1 å¿«é€Ÿå¯åŠ¨

```bash
# å®‰è£…ä¾èµ–
poetry install

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶

# å¯åŠ¨æœåŠ¡
poetry run uvicorn apps.main:app --reload
```

#### 9.2 Dockeréƒ¨ç½²

```dockerfile
# Dockerfile
FROM python:3.11-slim

WORKDIR /usr/src/app

# å®‰è£…Poetryå’Œä¾èµ–
COPY poetry.lock pyproject.toml ./
RUN pip install poetry && poetry install --no-dev

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY apps/ apps/
COPY libs/ libs/

# å¯åŠ¨æœåŠ¡
CMD ["poetry", "run", "uvicorn", "apps.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

#### 9.3 æ•°æ®åº“è¿ç§»

```bash
# å¯¼å‡ºæ•°æ®åº“ç»“æ„
poetry run python scripts/database/export_schema.py

# ç”Ÿæˆè¿ç§»è„šæœ¬
poetry run python scripts/database/snapshot_to_sql.py

# æ‰§è¡Œè¿œç¨‹è¿ç§»
poetry run python scripts/database/migrate_remote.py

# æ£€æŸ¥å¯¹é½çŠ¶æ€
poetry run python scripts/database/check_alignment.py
```

### 10. å¼€å‘è§„èŒƒ

#### 10.1 ä¸‰å±‚æ¶æ„æ¨¡å¼

ä¸¥æ ¼éµå¾ª`Endpoints â†’ Services â†’ Repositories`çš„åˆ†å±‚æ¶æ„ï¼š

- **Endpointså±‚**: ä»…å¤„ç†HTTPè¯·æ±‚/å“åº”ï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
- **Serviceså±‚**: å®ç°å®Œæ•´ä¸šåŠ¡ç”¨ä¾‹ï¼Œç¼–æ’Repositoryæ“ä½œ
- **Repositorieså±‚**: åŸå­åŒ–æ•°æ®æ“ä½œï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘

#### 10.2 ä»£ç è§„èŒƒ

- ä½¿ç”¨ç±»å‹æ³¨è§£ï¼Œæé«˜ä»£ç å¯è¯»æ€§
- éµå¾ªRESTful APIè®¾è®¡è§„èŒƒ
- å¼‚æ­¥ä¼˜å…ˆï¼Œæ”¯æŒé«˜å¹¶å‘å¤„ç†
- ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

### 11. æµ‹è¯•ç­–ç•¥

#### 11.1 æµ‹è¯•æ¶æ„

```bash
tests/
â”œâ”€â”€ agents/              # AIæ™ºèƒ½ä½“æµ‹è¯•
â”œâ”€â”€ api/                 # APIåŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ database/            # æ•°æ®åº“æµ‹è¯•
â”œâ”€â”€ integration/         # é›†æˆæµ‹è¯•
â”œâ”€â”€ tools/               # æµ‹è¯•å·¥å…·
â”œâ”€â”€ scripts/             # æµ‹è¯•è„šæœ¬
â””â”€â”€ reports/             # æµ‹è¯•æŠ¥å‘Š
```

#### 11.2 æµ‹è¯•è¿è¡Œ

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
poetry run pytest

# æŒ‰æ¨¡å—æµ‹è¯•
poetry run pytest tests/api/
poetry run pytest tests/database/

# ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
poetry run pytest --cov=apps --cov-report=html
```

---

## æ€»ç»“

å¯èˆªå¼•è·¯äººå¹³å°åŸºäºç°ä»£åŒ–çš„æŠ€æœ¯æ ˆå’Œæ¶æ„è®¾è®¡ï¼Œä¸ºç•™å­¦ç”³è¯·è€…æä¾›å…¨æ–¹ä½çš„AIæ™ºèƒ½æŒ‡å¯¼æœåŠ¡ã€‚é€šè¿‡`libs/app`åˆ†ç¦»æ¶æ„ã€ä¸‰å±‚æ¶æ„æ¨¡å¼å’Œæ¨¡å—åŒ–è®¾è®¡ï¼Œç¡®ä¿äº†ä»£ç çš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œé«˜æ€§èƒ½ã€‚

**æ ¸å¿ƒç‰¹è‰²**ï¼š

- ğŸ¤– **AIé©±åŠ¨**: é›†æˆLangGraphå’ŒOpenAIï¼Œæä¾›æ™ºèƒ½ç•™å­¦è§„åˆ’
- ğŸ¯ **ç²¾å‡†åŒ¹é…**: åŸºäºå¤šç»´åº¦ç®—æ³•çš„å¯¼å¸ˆ-å­¦ç”Ÿæ™ºèƒ½åŒ¹é…
- ğŸ’¬ **å®æ—¶äº¤äº’**: å®Œæ•´çš„æ¶ˆæ¯å’Œæ–‡ä»¶å…±äº«ç³»ç»Ÿ
- ğŸ—ï¸ **æ¶æ„ä¼˜è‰¯**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ”¯æŒå¿«é€Ÿè¿­ä»£å’Œæ‰©å±•
- â˜ï¸ **äº‘åŸç”Ÿ**: åŸºäºSupabaseçš„äº‘åŸç”Ÿæ•°æ®åº“å’Œå­˜å‚¨

è¯¥å¹³å°ä¸ä»…æŠ€æœ¯å…ˆè¿›ï¼Œæ›´é‡è¦çš„æ˜¯è¿æ¥äº†çœŸå®çš„ç•™å­¦éœ€æ±‚ä¸ä¾›ç»™ï¼Œä¸ºå­¦å­ä»¬çš„ç•™å­¦æ¢¦æƒ³æä¾›å¯é çš„æŠ€æœ¯æ”¯æ’‘ã€‚
