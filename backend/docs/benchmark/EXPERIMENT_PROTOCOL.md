# 实验协议

## 1. 通用流程
1) 预热 N=10 请求不计入统计
2) 设定并发: 1/5/10/20 RPS 梯度，持续 T=3 分钟/档
3) 每档重复 R=3 次，记录时间戳
4) 采集各阶段耗时: 规划、检索、重排、LLM、工具、网络
5) 记录 tokens 与费用（如适用）

## 2. 度量与采样
- 时间精度: 毫秒
- TTFT: 首次字节到达时刻-请求发出时刻
- TPS: 仅在生成阶段统计（排除前置等待）
- 质量抽样: 每条件随机抽取 n=50 样本做EM/人评

## 3. 变量控制
- 单变量消融: 仅变更一个因素
- 组合策略: 选取最优单项的可兼容组合
- 随机种子固定；任务顺序打散

## 4. 数据记录结构
- 逐请求行: 见 `TEMPLATES.md` 中 `template_results_log.csv`
- 聚合表: 组别/指标的均值、方差、置信区间

## 5. 负载阶段
- 冷启动: 观察TTFT抖动
- 稳态: p50/p95/p99
- 拥塞: 超时率与降级触发点

## 6. 质量保障
- 人评双盲、三点评分取稳健统计
- RAG证据覆盖由检索返回的元数据比对

## 7. 报告产出
- 图表: 前沿、箱线、误差棒、CDF
- 附录: 原始配置与日志片段
